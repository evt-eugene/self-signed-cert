(()=>{window.addEventListener("DOMContentLoaded",()=>{let _=["pem","crt","key","p7b","pfx","p12"],u={"1.2.840.113549.1.1.2":{name:"MD2 with RSA",securityLevel:"Weak (deprecated)"},"1.2.840.113549.1.1.3":{name:"MD4 with RSA",securityLevel:"Weak (deprecated)"},"1.2.840.113549.1.1.4":{name:"MD5 with RSA",securityLevel:"Weak (deprecated)"},"1.2.840.113549.1.1.5":{name:"SHA-1 with RSA",securityLevel:"Weak (deprecated)"},"1.2.840.10040.4.3":{name:"SHA-1 with DSA",securityLevel:"Weak (deprecated)"},"1.2.840.10045.4.1":{name:"SHA-1 with ECDSA",securityLevel:"Weak (deprecated)"},"1.3.14.3.2.29":{name:"SHA-1 with RSA (old)",securityLevel:"Weak (deprecated)"},"1.2.840.10045.4.3.1":{name:"SHA-224 with ECDSA",securityLevel:"Strong"},"1.2.840.113549.1.1.14":{name:"SHA-224 with RSA",securityLevel:"Strong"},"2.16.840.1.101.3.4.3.1":{name:"SHA-224 with DSA",securityLevel:"Strong"},"1.2.840.113549.1.1.11":{name:"SHA-256 with RSA",securityLevel:"Strong"},"2.16.840.1.101.3.4.3.2":{name:"SHA-256 with DSA",securityLevel:"Strong"},"1.2.840.10045.4.3.2":{name:"SHA-256 with ECDSA",securityLevel:"Strong"},"1.2.840.113549.1.1.12":{name:"SHA-384 with RSA",securityLevel:"Very Strong"},"1.2.840.10045.4.3.3":{name:"SHA-384 with ECDSA",securityLevel:"Very Strong"},"1.2.840.113549.1.1.13":{name:"SHA-512 with RSA",securityLevel:"Very Strong"},"1.2.840.10045.4.3.4":{name:"SHA-512 with ECDSA",securityLevel:"Very Strong"},"1.2.840.113549.1.1.10":{name:"RSA-PSS",securityLevel:"Very Strong"},"1.3.101.112":{name:"Ed25519",securityLevel:"Very Strong"},"1.3.101.113":{name:"Ed448",securityLevel:"Very Strong"},"1.2.643.2.2.3":{name:"GOST R 34.11-94 with GOST R 34.10-2001",securityLevel:"Weak (deprecated)"},"1.2.643.7.1.1.3.2":{name:"GOST R 34.11-2012 with GOST R 34.10-2012 (256 bit)",securityLevel:"Moderate To Strong"},"1.2.643.7.1.1.3.3":{name:"GOST R 34.11-2012 with GOST R 34.10-2012 (512 bit)",securityLevel:"Very Strong"}},I={"1.2.840.10045.3.1.7":"secp256r1 (P-256)","1.3.132.0.34":"secp384r1 (P-384)","1.3.132.0.35":"secp521r1 (P-521)","1.2.840.10045.3.1.1":"secp192r1 (P-192)","1.3.132.0.33":"secp224r1 (P-224)","1.3.132.0.10":"secp256k1"};document.getElementById("cert_file").addEventListener("change",e=>{let t=e.target.files[0];if(!t)return;document.getElementById("cert_details").classList.add("hidden");let n=t.name.split(".").pop().toLowerCase();if(!_.includes(n)){alert("Unsupported file type");return}let r=new FileReader;r.onload=o=>{let i=p(o.target.result,n);N(i)},r.onerror=()=>{console.error("File reading error",e),alert("Error reading file. Please try again.")},n==="pfx"||n==="p12"?r.readAsArrayBuffer(t):r.readAsText(t)});let p=(e,t)=>{try{return t==="pfx"||t==="p12"?B(L(e)):x(e)}catch(n){throw alert(`Error parsing certificate: ${n.message}`),n}},L=e=>{let t=new Uint8Array(e),n="";for(let r=0;r<t.length;r++)n+=String.fromCharCode(t[r]);return n},B=e=>{let t=prompt("Enter password for the PFX/PKCS#12 file (leave empty if none):",""),n=forge.asn1.fromDer(forge.util.createBuffer(e)),r=forge.pkcs12.pkcs12FromAsn1(n,t||""),o=forge.pki.oids.certBag,c=r.getBags({bagType:o})[o];if(!c||c.length===0)throw new Error("No certificate found in the PKCS#12 file");return c[0].cert},x=e=>{try{return forge.pki.certificateFromPem(e)}catch{let n=e.includes("BEGIN PRIVATE KEY")?"This appears to be a private key file. Please provide a certificate file instead.":"Invalid certificate format";throw new Error(n)}},N=e=>{document.getElementById("cert_details").classList.remove("hidden"),document.getElementById("cert_serial").textContent=e.serialNumber,document.getElementById("cert_version").textContent=`V${e.version+1}`;let t=e.issuer.attributes;document.getElementById("issuer_common_name").textContent=a(t),document.getElementById("issuer_organization").textContent=l(t),document.getElementById("issuer_organizational_unit").textContent=d(t),document.getElementById("issuer_locality").textContent=g(t),document.getElementById("issuer_state").textContent=m(t),document.getElementById("issuer_country").textContent=y(t),document.getElementById("issuer_email").textContent=f(t);let n=e.subject.attributes;document.getElementById("subject_common_name").textContent=a(n),document.getElementById("subject_organization").textContent=l(n),document.getElementById("subject_organizational_unit").textContent=d(n),document.getElementById("subject_locality").textContent=g(n),document.getElementById("subject_state").textContent=m(n),document.getElementById("subject_country").textContent=y(n),document.getElementById("subject_email").textContent=f(n),document.getElementById("cert_not_before").textContent=A(e.validity.notBefore),document.getElementById("cert_not_after").textContent=A(e.validity.notAfter);let r=e.siginfo?.algorithmOid||e.signatureOid;document.getElementById("cert_sig_alg").textContent=b(r),document.getElementById("cert_sig_alg_security_level").textContent=w(r);let o=e.siginfo?.parameters||e.signatureParameters||e.tbsCertificate?.signatureAlgorithm?.parameters;document.getElementById("cert_sig_params").textContent=k(r,o),document.getElementById("cert_signature").textContent=C(forge.util.bytesToHex(e.signature));let i=e.publicKey;document.getElementById("cert_key_alg").textContent="RSA",document.getElementById("cert_key_size").textContent=`${i.n?i.n.bitLength():0} bits`,document.getElementById("cert_key_exponent").textContent=i.e?i.e.toString(10):"",document.getElementById("cert_key_modulus").textContent=i.n?C(i.n.toString(16)):"",document.getElementById("cert_public_key").textContent=forge.pki.publicKeyToPem(i),document.getElementById("cert_key_usage").textContent=T(e.extensions);let c=forge.asn1.toDer(forge.pki.certificateToAsn1(e)).getBytes(),O=forge.md.sha1.create().update(c).digest().toHex(),U=forge.md.sha256.create().update(c).digest().toHex();document.getElementById("cert_sha1").textContent=v(O),document.getElementById("cert_sha256").textContent=v(U)},a=e=>s(e,["commonName","CN"]),l=e=>s(e,["organizationName","O"]),d=e=>s(e,["organizationalUnitName","OU"]),g=e=>s(e,["localityName","L"]),m=e=>s(e,["stateOrProvinceName","ST"]),y=e=>s(e,["countryName","C"]),f=e=>s(e,["emailAddress","E"]),s=(e,t)=>{let n=e.find(r=>t.includes(r.name)||t.includes(r.shortName));return n?n.value:"Not specified"},T=e=>{let t=e.find(r=>r.name==="keyUsage");return t&&Object.entries(t).filter(r=>r.key!=="id").filter(r=>r.key!=="name").filter(r=>r.value===!0).map(r=>r.key).join(", ")||"Not specified"},b=e=>{let t=u[e];return t?t.name:`Unknown algorithm (${e||"-"})`},w=e=>{let t=u[e];return t?t.securityLevel:"Unknown"},k=(e,t)=>t?t.tagClass!==void 0&&t.type===5?"NULL":e==="1.2.840.113549.1.1.10"?R(t):e&&e.startsWith("1.2.840.10045.4")?P(t):S(t):"None (NULL)",R=e=>{let t=["RSA-PSS Parameters:"];if(e.hashAlgorithm){let n=typeof e.hashAlgorithm=="string"?e.hashAlgorithm:e.hashAlgorithm.algorithm;t.push(`  Hash Algorithm: ${getHashAlgorithmName(n)} (${n})`)}if(e.mgf){let n=typeof e.mgf=="string"?e.mgf:e.mgf.algorithm;t.push(`  MGF: ${getMgfName(n)} (${n})`)}return e.saltLength!==void 0&&t.push(`  Salt Length: ${e.saltLength} bytes`),e.trailerField!==void 0&&t.push(`  Trailer Field: ${e.trailerField}`),t.join(`
`)},P=e=>e?e.namedCurve?`Named Curve: ${$(e.namedCurve)} (${e.namedCurve})`:e.curve?`Curve OID: ${e.curve}`:S(e):"None",$=e=>I[e]||"Unknown curve",S=e=>{if(e==null)return"None (NULL)";if(typeof e=="string")return`String: "${e}"`;if(typeof e=="number")return`Number: ${e}`;if(Array.isArray(e))return`Array: [${e.map(t=>E(t)).join(", ")}]`;if(typeof e=="object"){if(e.tagClass!==void 0)return h(e);let t=Object.entries(e);return t.length>0?`Object: {${t.map(([r,o])=>`${r}: ${E(o)}`).join(", ")}}`:"None"}return`Unknown type: ${typeof e}`},h=e=>{let n={1:"BOOLEAN",2:"INTEGER",3:"BIT STRING",4:"OCTET STRING",5:"NULL",6:"OBJECT IDENTIFIER",12:"UTF8 STRING",16:"SEQUENCE",17:"SET"}[e.type]||`Unknown(${e.type})`;return e.type===5?"NULL":e.type===6?`OID: ${e.value}`:e.type===2?`INTEGER: ${e.value}`:e.type===4?`OCTET STRING: ${Array.from(e.value).map(o=>o.toString(16).padStart(2,"0")).join(":")}`:`${n}: ${e.value||"[Complex Structure]"}`},E=e=>e==null?"null":typeof e=="string"?`"${e}"`:typeof e=="number"||typeof e=="boolean"?e.toString():typeof e=="object"?e.tagClass!==void 0?h(e):JSON.stringify(e):String(e),A=e=>e.toUTCString(),C=(e,t=32)=>{let n="";for(let r=0;r<e.length;r+=t)n+=e.substring(r,r+t)+`
`;return n.trim()},v=e=>e.match(/.{2}/g).join(":")});})();
