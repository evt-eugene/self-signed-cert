(()=>{window.addEventListener("DOMContentLoaded",function(){document.getElementById("cert_format").addEventListener("change",function(){document.getElementById("password").value="";let e=document.getElementById("cert_format").value,o=document.getElementById("password_label");e==="pfx"||e==="p12"?o.classList.remove("hidden"):o.classList.add("hidden")}),document.getElementById("generate_form").addEventListener("submit",function(e){e.preventDefault(),y()});function y(){let e=document.getElementById("cn").value,o=document.getElementById("org").value,t=document.getElementById("org_unit").value,g=document.getElementById("locality").value,f=document.getElementById("state").value,v=document.getElementById("country").value,E=parseInt(document.getElementById("years").value),B=document.getElementById("password").value,a=document.getElementById("cert_format").value,b=parseInt(document.getElementById("key_size").value),c=forge.pki,r=c.rsa.generateKeyPair({bits:b,e:65537}),n=c.createCertificate();n.publicKey=r.publicKey,n.serialNumber=Math.floor(Math.random()*1e16).toString(16);let d=new Date;n.validity.notBefore=d,n.validity.notAfter=new Date,n.validity.notAfter.setFullYear(d.getFullYear()+E);let i=[{name:"commonName",value:e},{name:"organizationName",value:o},{shortName:"OU",value:t},{name:"localityName",value:g},{name:"stateOrProvinceName",value:f},{name:"countryName",value:v}];n.setSubject(i),n.setIssuer(i),n.setExtensions([{name:"basicConstraints",cA:!0},{name:"keyUsage",keyCertSign:!0,digitalSignature:!0,nonRepudiation:!0,keyEncipherment:!0},{name:"subjectAltName",altNames:[{type:2,value:e}]}]),n.sign(r.privateKey,forge.md.sha256.create());let m=c.certificateToPem(n),u=c.privateKeyToPem(r.privateKey);if(a==="pem-bundle")s(`${e}.pem`,m+u);else if(a==="pem")s(`${e}.crt`,m),s(`${e}.key`,u);else if(a==="pfx"||a==="p12"){let w=forge.pkcs12.toPkcs12Asn1(r.privateKey,[n],B||null,{algorithm:"3des"}),I=forge.asn1.toDer(w).getBytes(),h=forge.util.encode64(I),k=new Blob([forge.util.decode64(h)],{type:"application/x-pkcs12"});p(`${e}.${a}`,k)}}function s(e,o){l(e,"data:text/plain;charset=utf-8,"+encodeURIComponent(o))}function p(e,o){let t=window.URL.createObjectURL(o);l(e,t),setTimeout(function(){window.URL.revokeObjectURL(t)},500)}function l(e,o){let t=document.createElement("a");t.href=o,t.download=e,t.style.display="none",document.body.appendChild(t),t.click(),setTimeout(function(){document.body.removeChild(t)},500)}});})();
