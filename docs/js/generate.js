(()=>{window.addEventListener("DOMContentLoaded",()=>{document.getElementById("cert_format").addEventListener("change",()=>{document.getElementById("password").value="";let e=document.getElementById("cert_format").value,n=document.getElementById("password_label");e==="pfx"||e==="p12"?n.classList.remove("hidden"):n.classList.add("hidden")}),document.getElementById("generate_form").addEventListener("submit",e=>{e.preventDefault(),v()});let v=()=>{let e=document.getElementById("cn").value,n=document.getElementById("org").value,t=document.getElementById("org_unit").value,l=document.getElementById("locality").value,s=document.getElementById("state").value,c=document.getElementById("country").value,r=parseInt(document.getElementById("years").value),m=document.getElementById("password").value,a=document.getElementById("cert_format").value,E=parseInt(document.getElementById("key_size").value),y=forge.pki,d=y.rsa.generateKeyPair({bits:E,e:65537}),o=y.createCertificate();o.publicKey=d.publicKey,o.serialNumber=Math.floor(Math.random()*1e16).toString(16);let p=new Date;o.validity.notBefore=p,o.validity.notAfter=new Date,o.validity.notAfter.setFullYear(p.getFullYear()+r);let g=[{name:"commonName",value:e},{name:"organizationName",value:n},{name:"organizationalUnitName",value:t},{name:"localityName",value:l},{name:"stateOrProvinceName",value:s},{name:"countryName",value:c}];o.setSubject(g),o.setIssuer(g),o.setExtensions([{name:"basicConstraints",cA:!0},{name:"keyUsage",keyCertSign:!0,digitalSignature:!0,nonRepudiation:!0,keyEncipherment:!0},{name:"subjectAltName",altNames:[{type:2,value:e}]}]),o.sign(d.privateKey,forge.md.sha256.create()),a==="pem-bundle"||a==="pem"?f(e,o,d,a):(a==="pfx"||a==="p12")&&w(e,o,d,m,a)},f=(e,n,t,l)=>{let s=forge.pki,c=s.certificateToPem(n),r=s.privateKeyToPem(t.privateKey);l==="pem-bundle"?i(`${e}.pem`,c+r):(i(`${e}.crt`,c),i(`${e}.key`,r))},w=(e,n,t,l,s)=>{let c=forge.pkcs12.toPkcs12Asn1(t.privateKey,[n],l||null,{algorithm:"3des"}),r=forge.asn1.toDer(c).getBytes(),m=forge.util.encode64(r),a=new Blob([forge.util.decode64(m)],{type:"application/x-pkcs12"});B(`${e}.${s}`,a)},i=(e,n)=>{u(e,"data:text/plain;charset=utf-8,"+encodeURIComponent(n))},B=(e,n)=>{let t=window.URL.createObjectURL(n);u(e,t),setTimeout(()=>window.URL.revokeObjectURL(t),500)},u=(e,n)=>{let t=document.createElement("a");t.href=n,t.download=e,t.style.display="none",document.body.appendChild(t),t.click(),setTimeout(()=>document.body.removeChild(t),500)}});})();
